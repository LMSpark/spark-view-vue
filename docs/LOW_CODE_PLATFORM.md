# SPARK.View 低代码平台架构设计

> 基于 DSL 的 Vue 低代码开发平台完整方案

## 🎯 平台定位

SPARK.View 是一个**企业级低代码开发平台**，专注于：

- 🎨 **可视化页面搭建**：拖拽式组件编排，所见即所得
- ⚡ **快速应用开发**：10分钟搭建完整应用，降低开发门槛
- 🏢 **企业级能力**：权限管理、数据集成、API 对接
- 🚀 **生产就绪**：一键生成优化的生产代码，支持多种部署方式

## 🏗️ 系统架构

### 核心组件

```
┌─────────────────────────────────────────────────────────────┐
│                      前端 - 低代码编辑器                        │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  组件面板    │  │  画布编辑器  │  │  属性配置    │         │
│  │ Component   │  │   Canvas    │  │  Properties │         │
│  │   Panel     │  │   Editor    │  │    Panel    │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  页面管理    │  │  数据源     │  │  预览/发布   │         │
│  │    Page     │  │   Data      │  │   Preview/  │         │
│  │  Manager    │  │   Source    │  │   Publish   │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
                            ↓ DSL Output
┌─────────────────────────────────────────────────────────────┐
│                    DSL 编译引擎 (已实现)                       │
├─────────────────────────────────────────────────────────────┤
│  Parser → Compiler → Vue Runtime                            │
│  (dsl-parser) (dsl-compiler) (runtime)                     │
└─────────────────────────────────────────────────────────────┘
                            ↓ Generated Code
┌─────────────────────────────────────────────────────────────┐
│                    运行时环境 (已实现)                         │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐       ┌──────────────┐                   │
│  │ SSR Server   │       │ Static Build │                   │
│  │ (ssr-server) │       │ (Compiler)   │                   │
│  └──────────────┘       └──────────────┘                   │
└─────────────────────────────────────────────────────────────┘
```

## 📋 功能模块规划

### ✅ 已实现功能

#### 1. DSL 核心引擎
- [x] JSON Schema 定义（15+ 组件类型）
- [x] DSL 解析器（YAML/JSON）
- [x] DSL 编译器（AST → Vue）
- [x] 表达式系统（{{ data.xxx }}）
- [x] 条件渲染与循环
- [x] 部分水合策略

#### 2. 基础编辑器
- [x] DSL 文本编辑器（textarea）
- [x] 实时编译预览
- [x] SSR/CSR 模式切换
- [x] 错误提示
- [x] 代码复制功能

#### 3. 运行时环境
- [x] SSR 服务器（Express 5）
- [x] 静态构建器（SPA 模式）
- [x] 客户端运行时
- [x] Redis 缓存支持
- [x] Docker 部署方案

### 🚧 待开发功能（v1.1-v2.0）

#### Phase 1: 可视化编辑器（v1.1.0）优先级：🔴 高

**目标**：从文本编辑升级到可视化拖拽编辑

- [ ] **组件面板**
  - [ ] 组件分类（布局、表单、数据展示、导航等）
  - [ ] 组件搜索与过滤
  - [ ] 组件预览缩略图
  - [ ] 自定义组件注册

- [ ] **画布编辑器**
  - [ ] 拖拽添加组件
  - [ ] 组件选中/多选
  - [ ] 组件拖动排序
  - [ ] 组件复制/粘贴/删除
  - [ ] Undo/Redo 操作历史
  - [ ] 组件树结构视图
  - [ ] 响应式预览（Desktop/Tablet/Mobile）

- [ ] **属性配置面板**
  - [ ] 动态表单生成（基于组件 schema）
  - [ ] 样式属性编辑（颜色、尺寸、间距等）
  - [ ] 数据绑定配置
  - [ ] 事件处理器配置
  - [ ] 条件显示配置
  - [ ] 动画效果配置

- [ ] **Monaco Editor 集成**
  - [ ] DSL 语法高亮
  - [ ] 智能提示（IntelliSense）
  - [ ] 错误检查与诊断
  - [ ] 格式化支持

**技术选型**：
- Vue3 Composition API
- VueDraggable / @dnd-kit/vue
- Monaco Editor
- Pinia 状态管理

#### Phase 2: 数据管理（v1.2.0）优先级：🔴 高

**目标**：支持动态数据源和 API 集成

- [ ] **数据源管理**
  - [ ] REST API 配置
  - [ ] GraphQL 支持
  - [ ] 静态 JSON 数据
  - [ ] 数据模型定义
  - [ ] 数据转换器（Transformer）

- [ ] **数据绑定**
  - [ ] 变量管理（全局/页面/组件）
  - [ ] 表达式编辑器
  - [ ] 数据联动配置
  - [ ] 数据格式化（日期、数字、货币等）

- [ ] **API 服务**
  - [ ] API 请求配置界面
  - [ ] 请求/响应拦截器
  - [ ] Mock 数据支持
  - [ ] API 测试工具

**数据流示例**：
```yaml
dataSources:
  - id: userApi
    type: rest
    baseURL: https://api.example.com
    endpoints:
      - name: getUsers
        path: /users
        method: GET
        
page:
  data:
    users: "{{ $api.userApi.getUsers() }}"
  layout:
    children:
      - type: list
        props:
          items: "{{ data.users }}"
```

#### Phase 3: 页面管理（v1.3.0）优先级：🟡 中

**目标**：支持多页面应用和路由管理

- [ ] **页面列表**
  - [ ] 创建/删除/重命名页面
  - [ ] 页面分组/文件夹
  - [ ] 页面搜索
  - [ ] 页面复制/导入/导出

- [ ] **路由管理**
  - [ ] 路由配置界面
  - [ ] 动态路由参数
  - [ ] 路由守卫配置
  - [ ] 面包屑导航

- [ ] **页面模板**
  - [ ] 内置模板库（登录页、列表页、详情页等）
  - [ ] 自定义模板保存
  - [ ] 模板市场

#### Phase 4: 组件市场（v1.4.0）优先级：🟡 中

**目标**：构建可扩展的组件生态

- [ ] **官方组件库**
  - [ ] 基础组件（20+）
  - [ ] 业务组件（表单、表格、图表等）
  - [ ] 高级组件（富文本、代码编辑器等）

- [ ] **自定义组件开发**
  - [ ] 组件开发 SDK
  - [ ] 组件打包工具
  - [ ] 组件文档生成
  - [ ] 组件版本管理

- [ ] **组件市场**
  - [ ] 组件浏览与搜索
  - [ ] 组件安装与卸载
  - [ ] 组件评分与评论
  - [ ] 付费组件支持

#### Phase 5: 协作与版本控制（v1.5.0）优先级：🟢 低

**目标**：支持团队协作开发

- [ ] **多人协作**
  - [ ] 实时协作编辑
  - [ ] 在线评论与批注
  - [ ] 操作冲突解决

- [ ] **版本管理**
  - [ ] Git 集成
  - [ ] 版本历史记录
  - [ ] 版本对比（Diff）
  - [ ] 回滚功能

- [ ] **权限管理**
  - [ ] 用户角色定义
  - [ ] 页面访问控制
  - [ ] 操作权限控制

#### Phase 6: 应用发布（v1.6.0）优先级：🟡 中

**目标**：一键发布到多种环境

- [ ] **构建优化**
  - [ ] 代码压缩与混淆
  - [ ] Tree-shaking
  - [ ] 图片优化
  - [ ] CDN 资源处理

- [ ] **部署集成**
  - [ ] Vercel 一键部署
  - [ ] Netlify 部署
  - [ ] 阿里云 OSS
  - [ ] 腾讯云 COS
  - [ ] 自定义服务器（SFTP/SSH）

- [ ] **预发布环境**
  - [ ] 预览链接生成
  - [ ] A/B 测试支持
  - [ ] 灰度发布

## 🎨 UI/UX 设计方向

### 编辑器布局

```
┌─────────────────────────────────────────────────────────────┐
│  Header: Logo | Project Name | Save | Preview | Publish     │
├────────┬────────────────────────────────────────┬────────────┤
│        │                                        │            │
│  组件   │            画布编辑区                   │   属性面板  │
│  面板   │                                        │            │
│        │                                        │            │
│  ┌───┐ │  ┌──────────────────────────────────┐ │  ┌──────┐ │
│  │布局│ │  │                                  │ │  │ 基础 │ │
│  │表单│ │  │       拖拽组件到此处              │ │  │ 样式 │ │
│  │数据│ │  │                                  │ │  │ 数据 │ │
│  │导航│ │  │                                  │ │  │ 事件 │ │
│  └───┘ │  └──────────────────────────────────┘ │  └──────┘ │
│        │                                        │            │
├────────┴────────────────────────────────────────┴────────────┤
│  Footer: Page Manager | Data Sources | Settings              │
└─────────────────────────────────────────────────────────────┘
```

### 设计原则

1. **简洁直观**：降低学习成本，新手 5 分钟上手
2. **高效操作**：快捷键、右键菜单、拖拽排序
3. **即时反馈**：实时预览、错误提示、操作历史
4. **响应式**：适配不同屏幕尺寸
5. **主题定制**：浅色/深色主题切换

## 🛠️ 技术栈

### 前端（编辑器）

| 模块 | 技术选型 | 理由 |
|------|----------|------|
| 框架 | Vue 3.5 + Composition API | 响应式性能优异 |
| 状态管理 | Pinia | Vue 官方推荐 |
| 拖拽 | VueDraggable / @dnd-kit | 成熟的拖拽方案 |
| 编辑器 | Monaco Editor | VSCode 同款 |
| UI 组件 | Element Plus / Ant Design Vue | 企业级组件库 |
| 图标 | Iconify | 100k+ 图标 |

### 后端（API 服务）

| 模块 | 技术选型 | 理由 |
|------|----------|------|
| 服务器 | Express 5 + TypeScript | 已集成，轻量高效 |
| 数据库 | PostgreSQL / MongoDB | 项目/页面数据存储 |
| 缓存 | Redis | 已集成 |
| 文件存储 | Minio / OSS | 静态资源管理 |
| 认证 | JWT + Passport | 用户认证授权 |

### 运行时（已有）

- Vue 3 SSR / SPA
- Vite 7 构建
- TypeScript 严格模式
- Docker 部署

## 📊 数据模型设计

### Project（项目）

```typescript
interface Project {
  id: string;
  name: string;
  description: string;
  thumbnail: string;
  owner: string;
  createdAt: Date;
  updatedAt: Date;
  settings: {
    baseURL: string;
    theme: string;
    seoConfig: SEOConfig;
  };
  pages: Page[];
}
```

### Page（页面）

```typescript
interface Page {
  id: string;
  projectId: string;
  name: string;
  path: string; // 路由路径
  title: string;
  dsl: DSLSchema; // 现有 DSL 格式
  thumbnail: string;
  createdAt: Date;
  updatedAt: Date;
  version: number;
}
```

### Component（自定义组件）

```typescript
interface CustomComponent {
  id: string;
  name: string;
  category: string;
  schema: JSONSchema;
  template: string; // Vue SFC
  thumbnail: string;
  author: string;
  downloads: number;
  rating: number;
}
```

## 🚀 实施路线图

### v1.1.0 - 可视化编辑器（Q1 2026）

**工期**：4-6 周

**核心功能**：
- 拖拽画布编辑器
- 组件面板（基础组件）
- 属性配置面板
- Monaco Editor 集成

**成果**：用户可以通过拖拽方式创建页面

### v1.2.0 - 数据管理（Q2 2026）

**工期**：3-4 周

**核心功能**：
- REST API 集成
- 数据绑定配置
- 变量管理

**成果**：支持动态数据渲染

### v1.3.0 - 页面管理（Q2 2026）

**工期**：2-3 周

**核心功能**：
- 多页面创建
- 路由管理
- 页面模板

**成果**：支持创建完整的多页面应用

### v1.4.0 - 组件市场（Q3 2026）

**工期**：4-6 周

**核心功能**：
- 官方组件库扩展
- 自定义组件 SDK
- 组件安装机制

**成果**：可扩展的组件生态

### v1.5.0 - 协作版本控制（Q3 2026）

**工期**：4-5 周

**核心功能**：
- 多人协作
- 版本管理
- 权限控制

**成果**：支持团队协作开发

### v1.6.0 - 应用发布（Q4 2026）

**工期**：3-4 周

**核心功能**：
- 一键部署
- 预发布环境
- 构建优化

**成果**：完整的发布流程

## 📈 竞品分析

| 平台 | 优势 | 劣势 | SPARK.View 差异化 |
|------|------|------|-------------------|
| 飞书多维表格 | 易用性强 | 定制性弱 | 更强的技术可控性 |
| 宜搭 | 阿里生态集成 | 依赖阿里云 | 开源、自主部署 |
| OutSystems | 企业级完善 | 价格昂贵 | 免费开源 |
| Appsmith | 开源免费 | 学习曲线陡 | 更简洁的 DSL |
| Retool | API 集成强 | 仅 SaaS | 支持私有部署 |

**SPARK.View 核心竞争力**：

1. ✅ **开源免费**：MIT 协议，社区驱动
2. ✅ **私有部署**：企业数据安全可控
3. ✅ **技术栈统一**：Vue 生态，前端团队无缝接入
4. ✅ **DSL 驱动**：简洁声明式，易于理解和扩展
5. ✅ **高性能**：SSR + 部分水合，首屏极速
6. ✅ **生产就绪**：完整的 Docker 部署方案

## 🎯 目标用户

### 主要用户群体

1. **初创团队**（0-50 人）
   - 需求：快速搭建 MVP，降低开发成本
   - 痛点：前端人力不足，开发周期紧张
   - 价值：10 分钟搭建原型，快速验证商业模式

2. **中小企业**（50-500 人）
   - 需求：内部管理系统、数据看板
   - 痛点：重复性开发工作多，维护成本高
   - 价值：统一技术栈，降低维护成本

3. **前端开发者**
   - 需求：快速交付简单页面，专注复杂业务
   - 痛点：大量重复性 UI 开发
   - 价值：提升开发效率，解放生产力

4. **产品经理/设计师**
   - 需求：独立搭建原型，无需等待开发
   - 痛点：沟通成本高，迭代速度慢
   - 价值：自主设计和验证，快速迭代

## 📚 后续文档规划

- [ ] **用户手册**：编辑器使用教程
- [ ] **开发指南**：自定义组件开发
- [ ] **API 文档**：DSL Schema 完整说明
- [ ] **最佳实践**：常见场景解决方案
- [ ] **插件开发**：扩展编辑器功能
- [ ] **部署指南**：多环境部署详解

---

**维护者**：SPARK.View Team  
**最后更新**：2026年1月3日  
**版本**：v1.0 架构设计
